= Kalshi
:toc: macro

Ruby client for the Kalshi API.

== Installation

Install the gem and add to the application's Gemfile by executing:

[source,bash]
----
bundle add kalshi
----

If bundler is not being used to manage dependencies, install the gem by executing:

[source,bash]
----
gem install kalshi
----

== Usage

=== Configuration

Configure the gem with your API key (optional for public endpoints). You can set it via the `KALSHI_API_KEY` environment variable or configure it explicitly:

[source,ruby]
----
Rubyists::Kalshi.configure do |config|
  config.api_key = 'your_api_key'
  config.base_url = 'https://api.elections.kalshi.com/trade-api/v2' # Default
end
----

=== Client

Initialize the client:

[source,ruby]
----
client = Rubyists::Kalshi.client
----

=== Market

Access Market endpoints via the `market` namespace.

==== Series List

https://docs.kalshi.com/api-reference/market/get-series-list[API Reference]

List series with optional filtering:

[source,ruby]
----
# List series with default filter
series_list = client.market.series_list.list

# List series with custom filter
series_list = client.market.series_list.list(category: 'Sports', tags: 'Football')
----

==== Series

https://docs.kalshi.com/api-reference/market/get-series[API Reference]

Get a specific series by ticker:

[source,ruby]
----
series = client.market.series.fetch('KX-SERIES')
----

==== Markets

https://docs.kalshi.com/api-reference/market/get-markets[API Reference]

List markets with optional filtering:

[source,ruby]
----
# List markets with default filter
markets = client.market.markets.list

# List markets with custom filter
markets = client.market.markets.list(status: 'open', limit: 10)
----

Get a specific market by ticker:

[source,ruby]
----
market = client.market.markets.fetch('KX-MARKET')
----

==== Orderbook

https://docs.kalshi.com/api-reference/market/get-market-orderbook[API Reference]

Get the orderbook for a market:

[source,ruby]
----
# Get full orderbook
orderbook = client.market.orderbook.fetch('KX-MARKET')

# Get orderbook with specific depth
orderbook = client.market.orderbook.fetch('KX-MARKET', depth: 10)
----

==== Trades

https://docs.kalshi.com/api-reference/market/get-trades[API Reference]

List trades with optional filtering:

[source,ruby]
----
# List trades with default filter
trades = client.market.trades.list

# List trades with custom filter
trades = client.market.trades.list(ticker: 'KX-MARKET', limit: 100)
----

==== Candlesticks

https://docs.kalshi.com/api-reference/market/get-market-candlesticks[API Reference]

Get candlesticks for a market:

[source,ruby]
----
candlesticks = client.market.candlesticks.fetch(
  series_ticker: 'KX-SERIES',
  ticker: 'KX-MARKET',
  start_ts: 1600000000,
  end_ts: 1600000060,
  period_interval: 1
)
----

https://docs.kalshi.com/api-reference/market/batch-get-market-candlesticks[API Reference]

Get candlesticks for multiple markets:

[source,ruby]
----
candlesticks = client.market.candlesticks.batch(
  tickers: ['KX-MARKET-1', 'KX-MARKET-2'],
  series_ticker: 'KX-SERIES',
  start_ts: 1600000000,
  end_ts: 1600000060,
  period_interval: 1
)
----

=== Search

Access Search endpoints via the `search` namespace.

==== Tags by Category

https://docs.kalshi.com/api-reference/search/get-tags-for-series-categories[API Reference]

Get tags organized by series categories:

[source,ruby]
----
tags = client.search.tags_by_category
----

==== Filters by Sport

https://docs.kalshi.com/api-reference/search/get-filters-for-sports[API Reference]

Get filters organized by sport:

[source,ruby]
----
filters = client.search.filters_by_sport
----

=== WebSocket Client

A raw WebSocket client is included in `bin/wss-raw` for testing connection and subscription.

IMPORTANT: This script requires the https://www.passwordstore.org/[`pass`] password manager to be installed and configured. It expects the API key on the first line and the PEM private key starting from the third line of the pass entry.

NOTE: If you aren't using `pass` yet, you should! It works on Windows, Android, macOS, Linux, and everything else. It is the standard unix password manager.

[source,bash]
----
# Default pass path: kalshi/api/initial-dev-ro
./bin/wss-raw

# Override pass path
KALSHI_PASS_PATH=my/custom/path ./bin/wss-raw
----

== Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake test` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and the created tag, and push the `.gem` file to [rubygems.org](https://rubygems.org).

== Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/rubyists/kalshi.
